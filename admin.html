<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        body { background: #222; color: #fff; font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-save { width: 100%; background: #00cec9; color: black; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-bottom: 20px; padding: 15px; border: none; border-radius: 8px; }
        .btn-save:hover { background: #00b5b0; }
        
        input, select, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; }
        input { border: 1px solid #555; background: #333; color: white; }
        
        .group-box { background: #444; padding: 15px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #555; }
        .member-row { display: flex; justify-content: space-between; align-items: center; background: #555; padding: 8px; margin-top: 5px; border-radius: 5px; }
        
        .del-btn { background: #ff7675; color: white; cursor: pointer; font-size: 0.8rem; }
        .add-btn { background: #6c5ce7; color: white; cursor: pointer; }
    </style>
</head>
<body>

    <h1>ğŸ› ï¸ UI í¸ì§‘ê¸° (GitHub ì—°ë™)</h1>
    <div style="text-align:center; margin-bottom:20px">
        <a href="index.html" style="color:#aaa; text-decoration:none;">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <button onclick="saveToGithub()" class="btn-save" id="saveBtn">ğŸ’¾ í˜„ì¬ ì„¤ì •ì„ GitHubì— ì €ì¥í•˜ê¸°</button>

    <div style="background:#333; padding:15px; border-radius:10px; text-align:center; border:1px solid #555;">
        <h3>â• ì¶”ê°€í•˜ê¸°</h3>
        <input type="text" id="gName" placeholder="ìƒˆ ê·¸ë£¹ ì´ë¦„">
        <button onclick="addGroup()" class="add-btn">ê·¸ë£¹ ë§Œë“¤ê¸°</button>
        <hr style="border-color:#555; margin:15px 0;">
        
        <select id="pf">
            <option value="soop">ğŸŒ² SOOP (ìˆ²)</option>
            <option value="chzzk">âš¡ CHZZK (ì¹˜ì§€ì§)</option>
        </select>
        <input type="text" id="mId" placeholder="ì•„ì´ë”” ì…ë ¥">
        <select id="targetG"></select>
        <button onclick="addMember()" class="add-btn">ë©¤ë²„ ì¶”ê°€</button>
    </div>

    <div id="previewArea" style="margin-top:20px;"></div>

<script>
    // ì´ˆê¸° ë°ì´í„° (ë¹„ì–´ìˆìŒ)
    let uiData = { groups: [] };

    // 1. ì‹œì‘í•˜ë©´ ê¸°ì¡´ list.jsonì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    async function init() {
        try {
            const res = await fetch('list.json?t=' + Date.now());
            if(res.ok) {
                uiData = await res.json();
                render();
            }
        } catch(e) { console.log("ì´ˆê¸° ë¡œë“œ ì‹¤íŒ¨"); }
    }

    // 2. [ì €ì¥] ë²„íŠ¼ í´ë¦­ ì‹œ -> GitHub API í˜¸ì¶œ
    async function saveToGithub() {
        const btn = document.getElementById('saveBtn');
        btn.innerText = "â³ GitHubì— ì €ì¥ ì¤‘... (ì ì‹œë§Œ ê¸°ë‹¤ë¦¬ì„¸ìš”)";
        btn.disabled = true;
        
        try {
            const res = await fetch('/api/save_github', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(uiData)
            });

            if(res.ok) {
                alert("âœ… ì„±ê³µ! GitHub íŒŒì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\nì•½ 1~2ë¶„ ë’¤ Vercel ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ë©”ì¸ í˜ì´ì§€ê°€ ë°”ë€ë‹ˆë‹¤.");
            } else {
                const err = await res.json();
                alert("âŒ ì‹¤íŒ¨: " + (err.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
            }
        } catch(e) { 
            alert("âŒ í†µì‹  ì˜¤ë¥˜ ë°œìƒ"); 
        } finally {
            btn.innerText = "ğŸ’¾ í˜„ì¬ ì„¤ì •ì„ GitHubì— ì €ì¥í•˜ê¸°";
            btn.disabled = false;
        }
    }

    // --- í™”ë©´ ê·¸ë¦¬ê¸° ë° ì¡°ì‘ ë¡œì§ ---
    function render() {
        const area = document.getElementById('previewArea');
        const sel = document.getElementById('targetG');
        area.innerHTML = ''; sel.innerHTML = '';

        uiData.groups.forEach((g, gIdx) => {
            sel.innerHTML += `<option value="${gIdx}">${g.name}</option>`;
            
            let membersHtml = '';
            g.members.forEach((m, mIdx) => {
                membersHtml += `
                    <div class="member-row">
                        <span>[${m.platform==='chzzk'?'C':'S'}] ${m.id}</span>
                        <button class="del-btn" onclick="delMember(${gIdx}, ${mIdx})">ì‚­ì œ</button>
                    </div>`;
            });

            area.innerHTML += `
                <div class="group-box">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0">${g.name}</h3>
                        <button class="del-btn" onclick="delGroup(${gIdx})">ê·¸ë£¹ì‚­ì œ</button>
                    </div>
                    ${membersHtml}
                </div>`;
        });
    }

    function addGroup() {
        const n = document.getElementById('gName').value;
        if(!n) return;
        uiData.groups.push({ name: n, members: [] });
        document.getElementById('gName').value = ''; render();
    }
    function addMember() {
        const id = document.getElementById('mId').value;
        const pf = document.getElementById('pf').value;
        const gIdx = document.getElementById('targetG').value;
        if(!id || gIdx==='') return alert("ê·¸ë£¹ì„ ë¨¼ì € ë§Œë“œì„¸ìš”");
        uiData.groups[gIdx].members.push({ id, platform: pf });
        document.getElementById('mId').value = ''; render();
    }
    function delMember(g, m) { uiData.groups[g].members.splice(m, 1); render(); }
    function delGroup(g) { uiData.groups.splice(g, 1); render(); }

    init();
</script>
</body>
</html>
