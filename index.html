<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer Board</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #42C769; --bg: #F0F2F5; --card: #ffffff; --text: #2f3542; }
        body { margin: 0; background: var(--bg); font-family: 'Pretendard', -apple-system, sans-serif; color: var(--text); }
        
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        header { text-align: center; margin-bottom: 40px; position: relative; }
        header h1 { color: #333; margin: 0; font-size: 2.5rem; letter-spacing: -1px; }
        
        /* ê´€ë¦¬ì ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .admin-btn { position: absolute; top: 0; right: 0; background: none; border: 1px solid #ddd; padding: 5px 10px; border-radius: 20px; cursor: pointer; color: #999; font-size: 0.8rem; }
        .admin-btn:hover { background: #333; color: white; border-color: #333; }
        
        /* ê´€ë¦¬ì íŒ¨ë„ (í‰ì†Œì—” ìˆ¨ê¹€) */
        #admin-panel { display: none; background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
        .input-group { display: flex; gap: 10px; justify-content: center; max-width: 400px; margin: 0 auto; }
        input[type="text"], input[type="password"] { padding: 10px; border: 1px solid #ddd; border-radius: 8px; flex: 1; }
        button.action-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button.action-btn:hover { opacity: 0.9; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        
        .card { 
            position: relative; /* ì‚­ì œ ë²„íŠ¼ ìœ„ì¹˜ ì¡ê¸° ìœ„í•´ */
            background: var(--card); border-radius: 20px; padding: 25px 15px; text-align: center; 
            cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        
        /* ì‚­ì œ ë²„íŠ¼ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ë³´ì„) */
        .delete-btn {
            display: none; position: absolute; top: 10px; right: 10px;
            width: 24px; height: 24px; background: #ff4757; color: white;
            border-radius: 50%; text-align: center; line-height: 22px;
            font-size: 14px; cursor: pointer; z-index: 10;
        }
        .card.is-live { border-color: #ff4757; }
        .card.is-live .live-badge { display: block; }
        
        .profile-wrapper { position: relative; width: 90px; height: 90px; margin: 0 auto 15px; }
        .card img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #eee; background: #eee;}
        .card.is-live img { border-color: #ff4757; }
        
        .live-badge { display: none; position: absolute; bottom: 0; right: 0; background: #ff4757; color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; border: 2px solid white; }
        .card h3 { margin: 10px 0 5px; font-size: 1.1rem; color: #333; }
        .status-text { font-size: 0.85rem; color: #888; }
        .card.is-live .status-text { color: #ff4757; font-weight: bold; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; backdrop-filter: blur(3px); }
        .modal-content { background: white; margin: 5vh auto; padding: 30px; width: 90%; max-width: 600px; border-radius: 20px; max-height: 90vh; overflow-y: auto; }
        .close-btn { float: right; font-size: 2rem; cursor: pointer; color: #999; }
        
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 20px; }
        .cal-head { font-weight: bold; text-align: center; color: #747d8c; padding: 5px 0; }
        .cal-day { aspect-ratio: 1; border: 1px solid #f0f0f0; border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.9rem; position: relative; }
        .cal-day.has-vod { background-color: #e3fcf0; border-color: var(--primary); color: var(--primary); font-weight: bold; }
        .chart-box { margin-top: 30px; height: 250px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Streamer Board</h1>
        <p>ì‹¤ì‹œê°„ ë°©ì†¡ í˜„í™©</p>
        <button class="admin-btn" onclick="toggleAdmin()">âš™ï¸ ì„¤ì •</button>
    </header>

    <div id="admin-panel">
        <h3>ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</h3>
        <div class="input-group">
            <input type="text" id="new-id" placeholder="ì¶”ê°€í•  BJ ID ì…ë ¥ (ì˜ˆ: woowakgood)">
            <button class="action-btn" onclick="addStreamer()">ì¶”ê°€</button>
        </div>
        <p style="font-size:0.8rem; color:#888; margin-top:10px;">* IDëŠ” ë°©ì†¡êµ­ ì£¼ì†Œ ë§¨ ë’¤ì˜ ì˜ë¬¸ì…ë‹ˆë‹¤.</p>
    </div>

    <div id="card-list" class="grid"></div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modal-title">ë°©ì†¡ ê¸°ë¡</h2>
        <div class="calendar" id="calendar-grid"></div>
        <div class="chart-box"><canvas id="timeChart"></canvas></div>
    </div>
</div>

<script>
    // ==========================================
    // ğŸ” ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ì›í•˜ëŠ” ë¹„ë²ˆìœ¼ë¡œ ë°”ê¾¸ì„¸ìš”!)
    const ADMIN_PASSWORD = "1234"; 
    // ==========================================

    const list = document.getElementById('card-list');
    let isAdmin = false;

    // 1. ì €ì¥ëœ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
    function getSavedList() {
        const saved = localStorage.getItem('myStreamerList');
        if (saved) {
            return JSON.parse(saved);
        } else {
            // ì²˜ìŒ ì‹¤í–‰ ì‹œ ê¸°ë³¸ ëª©ë¡
            return ['bluejin0129', 'moonightwmn']; 
        }
    }

    // 2. ì´ˆê¸° ì‹¤í–‰
    async function init() {
        list.innerHTML = ''; 
        const targetIds = getSavedList();

        if(targetIds.length === 0) {
            list.innerHTML = '<p style="text-align:center; width:100%;">ë“±ë¡ëœ ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        for (const id of targetIds) {
            createCard(id); // ì¹´ë“œ ë¼ˆëŒ€ ìƒì„±
            fetchData(id);  // ë°ì´í„° ìš”ì²­
        }
    }

    // ì¹´ë“œ ìƒì„± í•¨ìˆ˜
    function createCard(id) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${id}`;
        card.innerHTML = `
            <div class="delete-btn" onclick="removeStreamer(event, '${id}')">X</div>
            <div class="profile-wrapper" style="background:#eee; border-radius:50%"></div>
            <h3>${id}</h3>
            <p class="status-text">ë¡œë”©ì¤‘...</p>
        `;
        card.onclick = (e) => {
            // ì‚­ì œ ë²„íŠ¼ ëˆ„ë¥¼ ë• ëª¨ë‹¬ ì•ˆ ì—´ë¦¬ê²Œ ë°©ì§€
            if (!e.target.classList.contains('delete-btn')) openModal(id);
        };
        list.appendChild(card);
    }

    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function fetchData(id) {
        const cardElement = document.getElementById(`card-${id}`);
        if(!cardElement) return;

        try {
            const res = await fetch(`/api/info?id=${id}`);
            const data = await res.json();
            
            if (data.isLive) cardElement.classList.add('is-live');
            
            // ê¸°ì¡´ì˜ ì‚­ì œ ë²„íŠ¼ì€ ìœ ì§€í•˜ë©´ì„œ ë‚´ìš© ì—…ë°ì´íŠ¸
            const delBtn = `<div class="delete-btn" onclick="removeStreamer(event, '${id}')" style="display:${isAdmin ? 'block' : 'none'}">X</div>`;
            
            cardElement.innerHTML = `
                ${delBtn}
                <div class="profile-wrapper">
                    <img src="${data.img}" onerror="this.src='https://via.placeholder.com/90'">
                    <span class="live-badge">LIVE</span>
                </div>
                <h3>${data.name}</h3>
                <p class="status-text">${data.isLive ? 'ğŸ”´ ë°©ì†¡ì¤‘' : 'âš« ì˜¤í”„ë¼ì¸'}</p>
            `;
        } catch (err) {
            // ì—ëŸ¬ ë‚˜ë„ ì¹´ë“œëŠ” ìœ ì§€
            console.error(err);
        }
    }

    // --- ê´€ë¦¬ì ê¸°ëŠ¥ ---

    // ê´€ë¦¬ì ëª¨ë“œ ì¼œê¸°/ë„ê¸°
    function toggleAdmin() {
        if (!isAdmin) {
            const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (pw === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('admin-panel').style.display = 'block';
                document.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = 'block');
                alert("ê´€ë¦¬ì ëª¨ë“œ ì ‘ì† ì™„ë£Œ! ì¹´ë“œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            } else {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        } else {
            isAdmin = false;
            document.getElementById('admin-panel').style.display = 'none';
            document.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = 'none');
        }
    }

    // ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€
    function addStreamer() {
        const input = document.getElementById('new-id');
        const newId = input.value.trim();
        
        if (!newId) return alert("IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        const currentList = getSavedList();
        if (currentList.includes(newId)) return alert("ì´ë¯¸ ë“±ë¡ëœ IDì…ë‹ˆë‹¤.");

        // ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ê³  ì €ì¥
        currentList.push(newId);
        localStorage.setItem('myStreamerList', JSON.stringify(currentList));
        
        // í™”ë©´ì— ë°”ë¡œ ë°˜ì˜
        input.value = '';
        createCard(newId);
        fetchData(newId);
        
        // ê´€ë¦¬ì ëª¨ë“œë‹ˆê¹Œ ì‚­ì œ ë²„íŠ¼ ë°”ë¡œ ë³´ì´ê²Œ
        setTimeout(() => {
            const btn = document.querySelector(`#card-${newId} .delete-btn`);
            if(btn) btn.style.display = 'block';
        }, 100);
    }

    // ìŠ¤íŠ¸ë¦¬ë¨¸ ì‚­ì œ
    function removeStreamer(e, id) {
        e.stopPropagation(); // ì¹´ë“œ í´ë¦­(ëª¨ë‹¬ ì—´ê¸°) ë°©ì§€
        if (!confirm(`ì •ë§ '${id}'ë‹˜ì„ ëª©ë¡ì—ì„œ ì‚­ì œí• ê¹Œìš”?`)) return;

        let currentList = getSavedList();
        currentList = currentList.filter(item => item !== id);
        localStorage.setItem('myStreamerList', JSON.stringify(currentList));

        // í™”ë©´ì—ì„œ ì œê±°
        const card = document.getElementById(`card-${id}`);
        if(card) card.remove();
    }

    // ëª¨ë‹¬ ë° ê¸°íƒ€ (ê¸°ì¡´ ìœ ì§€)
    function openModal(name) {
        document.getElementById('modal').style.display = 'block';
        document.getElementById('modal-title').innerText = `${name}ë‹˜ì˜ ê¸°ë¡`;
        renderCalendar(); renderChart();
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function renderCalendar() { /* ë‹¬ë ¥ ë Œë”ë§ (ìƒëµ - ê¸°ì¡´ ìœ ì§€) */ 
        const grid = document.getElementById('calendar-grid'); grid.innerHTML=''; 
        for(let i=0; i<31; i++) grid.innerHTML+=`<div class="cal-day">${i+1}</div>`; 
    }
    function renderChart() { 
        const ctx = document.getElementById('timeChart');
        new Chart(ctx, { type:'line', data:{labels:[1,2,3], datasets:[{label:'Time', data:[10,20,15]}]} });
    }
    window.onclick = (e) => { if(e.target == document.getElementById('modal')) closeModal(); }

    init();
</script>

</body>
</html>
